<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>muSE: Raising and handling exceptions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">muSE
   &#160;<span id="projectnumber">r771</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Raising and handling exceptions</div>  </div>
</div><!--header-->
<div class="contents">
<div id="dynsection-0" onclick="return toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Raising and handling exceptions:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<center><table><tr><td><img src="group__Exceptions.png" border="0" alt="" usemap="#group____Exceptions"/>
<map name="group____Exceptions" id="group____Exceptions">
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__Exceptions__impl"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Exceptions__impl.html">Internals</a></td></tr>
<tr class="memdesc:group__Exceptions__impl"><td class="mdescLeft">&#160;</td><td class="mdescRight">muSE implements an exception mechanism that allows you to normally resume computation from the point where an exception is raised. <br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5f269e91f495a449de3d4ce4443647ce"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Exceptions.html#ga5f269e91f495a449de3d4ce4443647ce">syntax_try</a> (<a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *env, void *context, <a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> args)</td></tr>
<tr class="memdesc:ga5f269e91f495a449de3d4ce4443647ce"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks an expression that needs to be protected by exception handlers.  <a href="#ga5f269e91f495a449de3d4ce4443647ce"></a><br/></td></tr>
<tr class="separator:ga5f269e91f495a449de3d4ce4443647ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1387a9ecca255bea4575ec0a2f06031b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Exceptions.html#ga1387a9ecca255bea4575ec0a2f06031b">fn_raise</a> (<a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *env, void *context, <a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> args)</td></tr>
<tr class="memdesc:ga1387a9ecca255bea4575ec0a2f06031b"><td class="mdescLeft">&#160;</td><td class="mdescRight">(raise [exception-details])  <a href="#ga1387a9ecca255bea4575ec0a2f06031b"></a><br/></td></tr>
<tr class="separator:ga1387a9ecca255bea4575ec0a2f06031b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2dd6af73151c4c15d568c37c671d9ea0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Exceptions.html#ga2dd6af73151c4c15d568c37c671d9ea0">fn_retry</a> (<a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *env, void *context, <a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> args)</td></tr>
<tr class="memdesc:ga2dd6af73151c4c15d568c37c671d9ea0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Similar to <a class="el" href="group__Exceptions.html#ga1387a9ecca255bea4575ec0a2f06031b">raise</a> but does not prepend a resume continuation to the trial condition.  <a href="#ga2dd6af73151c4c15d568c37c671d9ea0"></a><br/></td></tr>
<tr class="separator:ga2dd6af73151c4c15d568c37c671d9ea0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6a3b577e71d946b5d30673bf85c94720"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__Exceptions.html#ga6a3b577e71d946b5d30673bf85c94720">syntax_finally</a> (<a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *env, void *context, <a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> args)</td></tr>
<tr class="separator:ga6a3b577e71d946b5d30673bf85c94720"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga5f269e91f495a449de3d4ce4443647ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> syntax_try </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Marks an expression that needs to be protected by exception handlers. </p>
<p>A try block has the following syntax - </p>
<div class="fragment"><div class="line">(<span class="keywordflow">try</span></div>
<div class="line">     expr</div>
<div class="line">     handler1</div>
<div class="line">     handler2</div>
<div class="line">     ....</div>
<div class="line">)</div>
</div><!-- fragment --><p>First it tries to evaluate the given <code>expr</code>. If the expression raised an exception using (raise...), then each of the handlers is tried in turn until one matches. The handlers are evaluated at the time the try block is entered, not when an exception is raised, so for efficiency reasons you should use in-place handlers (using the macro brace facility) which do not refer to the lexical context of the try block if possible and use closures for handlers only when you absolutely need them. If your handlers are predetermined before entering the try block and you only need to evaluate a symbol to get at the handlers, then entering a try block is efficient.</p>
<p>A handler can be a function expression - like (fn args expr) or (fn: args expr). If it is such an expression, each handler is tried in turn until the argument pattern of one of the handlers matches the raised exception. The body of the handler whose arguments matched the exception is evaluated and the result is returned as the result of the try block.</p>
<p>The first argument to the handler is an exception object whose sole purpose is to enable the handler to resume the computation with a given value as the result of the (raise...) expression that raised the exception. The rest of the arguments to a handler are the same arguments that were passed to <code>raise</code>.</p>
<p>Handlers may themselves raise exceptions. The raised exceptions start <b>again</b> from the inner most set of handlers and try to find another handler to match it. This gives you the facility to decide exception handling policies at a level higher than the level that implements the policy. Note that if you raise the same exception pattern captured by the handler, you'll <b>not</b> end up in the same handler again in an infinite loop and blow the stack. The handler invocation is protected from such re-entry. This lets you delegate the exception to an even higher level.</p>
<p>If a handler is not a function object, then its value is used as the value of the try block without further checks. Such a "handler" always succeeds.</p>
<p>If none of the handlers match, then the handlers of the previous enclosing try block are examined.</p>
<p>A handler may choose to resume the computation by invoking the exception object with the desired value that should be returned by the (raise ...) expression.</p>
<p>If continuations are captured in the middle of try blocks, they will automatically include the correct state of the try block nesting because they will capture the correct value of the "{{trap}}" symbol.</p>
<p>It is convenient to use read-time evaluated dynamically scoped function objects as handlers since they cause the least overhead and are usually sufficiently general. For example - </p>
<div class="fragment"><div class="line">(<span class="keywordflow">try</span> </div>
<div class="line">  (<span class="keywordflow">do</span> (write <span class="stringliteral">&quot;Difference = &quot;</span></div>
<div class="line">        (<span class="keywordflow">if</span> (&lt; a b)</div>
<div class="line">               (- b a)</div>
<div class="line">            (<span class="keyword">raise</span> <span class="stringliteral">&#39;NotInOrder a b)))</span></div>
<div class="line"><span class="stringliteral">      (write &quot;Product = &quot; (* a b)))</span></div>
<div class="line"><span class="stringliteral">      </span></div>
<div class="line"><span class="stringliteral">  {fn: (ex &#39;</span>NotInOrder x y)</div>
<div class="line">          (ex (- x y))})</div>
</div><!-- fragment --> 
<p>References <a class="el" href="group__MuseAPI.html#gade523dbd5ea9a62950c4a3f8dd2d58c1">muse_try()</a>.</p>

</div>
</div>
<a class="anchor" id="ga1387a9ecca255bea4575ec0a2f06031b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> fn_raise </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(raise [exception-details]) </p>
<p>Raises an exception described by the given arguments. Handlers are matched against the pattern of arguments to determine which handler to use to handle the exception. It is useful to use a quoted symbol as the first argument which describes the exception. A handler can then specify the same quoted symbol as its second argument in order to get to handle the exception.</p>
<p>(raise..) evaluates the matching handler without unwinding to the enclosing try block. This means any raised exception can be resumed by invoking the exception object (passed as the first argument to the handler) with the resume value as the argument.</p>
<dl class="section see"><dt>See Also</dt><dd><a class="el" href="group__Exceptions.html#ga5f269e91f495a449de3d4ce4443647ce" title="Marks an expression that needs to be protected by exception handlers.">syntax_try</a> </dd></dl>

<p>References <a class="el" href="group__MuseAPI.html#gaf4509f4d0b6b34c923ec1aa1aeda019e">muse_eval_list()</a>.</p>

</div>
</div>
<a class="anchor" id="ga2dd6af73151c4c15d568c37c671d9ea0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> fn_retry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Similar to <a class="el" href="group__Exceptions.html#ga1387a9ecca255bea4575ec0a2f06031b">raise</a> but does not prepend a resume continuation to the trial condition. </p>
<p>This is useful to provide alternative inner code paths that can be invoked from an outer level. The argument pattern of an alternative should not expect a resume continuation as the first argument.</p>
<p>While a "raise" expression may evaluate to some value, a "retry" exception never completes evaluation, so it is not meaningful to use its result value for anything. </p>

<p>References <a class="el" href="group__MuseAPI.html#gaf4509f4d0b6b34c923ec1aa1aeda019e">muse_eval_list()</a>, <a class="el" href="group__MuseAPI.html#gafa6f83554ab1865d2df3bb642b399b66">muse_message()</a>, <a class="el" href="group__MuseAPI.html#gga71b858b1a2cd474be8f987d0271f1890a691eefc496b45215c8ff94a59de008c3">MUSE_NIL</a>, <a class="el" href="group__MuseAPI.html#gga71b858b1a2cd474be8f987d0271f1890a26eb42e571e76279d067c18026a281dc">MUSE_TRAP_POINT</a>, and <a class="el" href="group__Processes__impl.html#ga9735d3f457ead63c447d5cc2db8cbdef">remove_process()</a>.</p>

</div>
</div>
<a class="anchor" id="ga6a3b577e71d946b5d30673bf85c94720"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a> syntax_finally </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga93436fada5a32eee71ac3391b225a0d2">muse_env</a> *&#160;</td>
          <td class="paramname"><em>env</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__MuseAPI.html#ga965ab909826d7eb8043c4cac792555ec">muse_cell</a>&#160;</td>
          <td class="paramname"><em>args</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line">(<span class="keywordflow">finally</span> ...block...) </div>
</div><!-- fragment --><p>Installs a finalizer for the current trap state. A finally block's body will be captured in a closure and installed as a finalizer thunk. This thunk will be invoked at the point when the immediately enclosing <a class="el" href="group__Exceptions.html#ga5f269e91f495a449de3d4ce4443647ce">try</a> block completes - normally or abnormally. <code>finally</code> thus provides a cleanup mechanism for resources that might otherwise be left lingering around.</p>
<p>Note that <code>finally</code> is not a clause <em>outside</em> the expression protected by a <code>try</code>, but actually occurs and is evaluated within the protected code block. Therefore it can occur not merely within the syntactic scope of a try expression, but actually anywhere (and any number of times) within the execution scope of the try expression - including any functions called within the expression. </p>

<p>References <a class="el" href="muse__builtin__continuation_8c.html#ae40d359c2c4eba23134b5cc34d2ef2b5">fn_with_recent()</a>, <a class="el" href="group__MuseAPI.html#gafa6f83554ab1865d2df3bb642b399b66">muse_message()</a>, <a class="el" href="group__MuseAPI.html#gga71b858b1a2cd474be8f987d0271f1890a691eefc496b45215c8ff94a59de008c3">MUSE_NIL</a>, <a class="el" href="group__MuseAPI.html#gga71b858b1a2cd474be8f987d0271f1890a26eb42e571e76279d067c18026a281dc">MUSE_TRAP_POINT</a>, and <a class="el" href="group__CoreLanguage.html#ga9cf0e1a4958ba27dfe9e7034c9ef82c2">syntax_lambda()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Jan 11 2013 12:31:05 for muSE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.3
</small></address>
</body>
</html>
